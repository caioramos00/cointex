{% load theming %}{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, viewport-fit=cover" />

  <!-- verificação Meta (mantido) -->
  <meta name="facebook-domain-verification" content="73hwg7lythnnqtl0mtlqdgyewx6h3z" />

  <!-- PWA / ícones -->
  <link rel="manifest" href="{% themed_static 'manifest.json' %}" />
  <link rel="icon" href="{% themed_static 'images/logo/favicon.png' %}" type="image/png" />
  <link rel="apple-touch-icon" href="{% themed_static 'images/logo/favicon.png' %}" />
  <meta name="theme-color" content="#122636" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="MPay" />
  <meta name="msapplication-TileImage" content="{% themed_static 'images/logo/favicon.png' %}" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />

  <title>Criar conta — MPay</title>

  <!-- fontes Google (opcional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400;700;900&display=swap" rel="stylesheet" />

  <!-- CSS MPay -->
  <link rel="stylesheet" id="rtl-link" type="text/css" href="{% themed_static 'css/vendors/bootstrap.min.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% themed_static 'css/vendors/swiper-bundle.min.css' %}" />
  <link rel="stylesheet" id="change-link" type="text/css" href="{% themed_static 'css/style.css' %}" />
  <link rel="stylesheet" href="{% themed_static 'css/overrides.css' %}">

  <style>
  /* Endurecer estilo dos inputs MPay contra CSS legado */
  .auth-form .form-group,
  .auth-form .form-input { width: 100%; }

  .auth-form input.form-control,
  .auth-form select.form-control,
  .auth-form textarea.form-control,
  .auth-form .form-input input,
  .auth-form .form-input select,
  .auth-form .form-input textarea {
    width: 100% !important;
    display: block;
    box-sizing: border-box;
    height: 48px;
    border-radius: 10px;
  }

  /* labels/checkbox alinhados */
  .auth-form .form-check-input { width: auto; height: auto; }

  /* botão ocupa a linha toda (caso algo reduza) */
  .auth-form .btn { width: 100%; }
</style>


  <!-- === PIXELS & TRACKING (mantidos do Cointex) === -->
  <script>
    !function (f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init','1414661506543941');
    fbq('init','24796423593276136');
    fbq('init','780359434541574');
    fbq('track','PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1414661506543941&ev=PageView&noscript=1"/>
    <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=24796423593276136&ev=PageView&noscript=1"/>
    <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=780359434541574&ev=PageView&noscript=1"/>
  </noscript>

  <!-- UTMify (mantido) -->
  <script
    src="https://cdn.utmify.com.br/scripts/utms/latest.js"
    data-utmify-prevent-xcod-sck
    data-utmify-prevent-subids
    async defer></script>
  <script>
    window.pixelId = "68c4b6df444a2a1e6ba9ed17";
    var a = document.createElement("script");
    a.setAttribute("async",""); a.setAttribute("defer","");
    a.setAttribute("src","https://cdn.utmify.com.br/scripts/pixel/pixel.js");
    document.head.appendChild(a);
  </script>

  <!-- TikTok Pixel (mantido) -->
  <script>
  !function (w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];
  ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"];
  ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
  ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e};
  ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;
  ttq._i=ttq._i||{},ttq._i[e]=[],ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};
  n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src=r+"?sdkid="+e+"&lib="+t;
  e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
  ttq.load('D31KIHJC77U0B8UM6JJG'); ttq.page();
  }(window,document,'ttq');
  </script>
</head>

<body class="mpay-theme auth-body">
  <!-- header -->
  <div class="auth-header">
    <a href="{% url 'accounts:login' %}"><i class="back-btn" data-feather="arrow-left"></i></a>
    <img class="img-fluid img" src="{% themed_static 'images/authentication/6.svg' %}" alt="Cadastro" />
    <div class="auth-content">
      <div>
        <h2>Crie sua conta</h2>
        <h4 class="p-0">Preencha o formulário abaixo</h4>
      </div>
    </div>
  </div>

  <!-- formulário de cadastro -->
  <form class="auth-form" method="post" action="">
    {% csrf_token %}

    {% if messages %}
      <div class="custom-container">
        {% for message in messages %}
          <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} mt-2" role="alert">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if form.non_field_errors %}
      <div class="custom-container">
        <div class="alert alert-danger mt-2">
          {% for error in form.non_field_errors %}{{ error }}{% endfor %}
        </div>
      </div>
    {% endif %}

    <div class="custom-container">
      <!-- Nome de usuário -->
      <div class="form-group">
        <label for="id_username" class="form-label">Nome de usuário</label>
        <div class="form-input">
          {{ form.username }}
        </div>
        {% if form.username.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.username.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- Nome -->
      <div class="form-group">
        <label for="id_first_name" class="form-label">Nome</label>
        <div class="form-input">
          {{ form.first_name }}
        </div>
        {% if form.first_name.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.first_name.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- Sobrenome -->
      <div class="form-group">
        <label for="id_last_name" class="form-label">Sobrenome</label>
        <div class="form-input">
          {{ form.last_name }}
        </div>
        {% if form.last_name.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.last_name.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- Data de nascimento -->
      <div class="form-group">
        <label for="date_of_birth" class="form-label">Data de nascimento</label>
        <div class="form-input">
          {# garantimos o id esperado pelo IMask: 'date_of_birth' #}
            {{ form.date_of_birth }}
        </div>
        {% if form.date_of_birth.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.date_of_birth.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- CPF -->
      <div class="form-group">
        <label for="cpf" class="form-label">CPF</label>
        <div class="form-input">
          {# garantimos o id esperado pelo IMask: 'cpf' #}
          {{ form.cpf }}
        </div>
        {% if form.cpf.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.cpf.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- E-mail -->
      <div class="form-group">
        <label for="id_email" class="form-label">E-mail</label>
        <div class="form-input">
          {{ form.email }}
        </div>
        {% if form.email.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.email.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- Telefone -->
      <div class="form-group">
        <label for="phone_number" class="form-label">Telefone</label>
        <div class="form-input">
          {# garantimos o id esperado pelo IMask: 'phone_number' #}
          {{ form.phone_number }}
        </div>
        {% if form.phone_number.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.phone_number.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- Senha -->
      <div class="form-group">
        <label for="id_password1" class="form-label">Senha</label>
        <div class="form-input box-auth-pass">
          {{ form.password1 }}
          <span class="show-pass">
            <i class="icon-view"></i><i class="icon-view-hide"></i>
          </span>
        </div>
        {% if form.password1.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.password1.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- Confirmar senha -->
      <div class="form-group">
        <label for="id_password2" class="form-label">Confirmar senha</label>
        <div class="form-input box-auth-pass">
          {{ form.password2 }}
          <span class="show-pass2">
            <i class="icon-view"></i><i class="icon-view-hide"></i>
          </span>
        </div>
        {% if form.password2.errors %}
          <small class="text-danger d-block mt-1">
            {% for error in form.password2.errors %}{{ error }}{% endfor %}
          </small>
        {% endif %}
      </div>

      <!-- Termos -->
      <div class="remember-option mt-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="1" id="aceito-termos" checked />
          <label class="form-check-label" for="aceito-termos">
            Eu concordo com os <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Termos e Condições</a>
          </label>
        </div>
      </div>

      <!-- CTA -->
      <button type="submit" class="btn theme-btn w-100 mt-3">Criar conta</button>

      <h4 class="signup">Já tem uma conta?
        <a href="{% url 'accounts:login' %}"> Entrar</a>
      </h4>
    </div>
  </form>

  <!-- Modal: Termos e Condições (conteúdo mantido) -->
  <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="termsModalLabel">Termos e Condições de Uso</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          {# Mantive seu texto/estrutura de termos extenso do template original #}
          {{ terms_html|default:"<p>Ao criar sua conta, você aceita nossos Termos e Condições e a Política de Privacidade.</p>"|safe }}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS MPay -->
  <script src="{% themed_static 'js/feather.min.js' %}"></script>
  <script src="{% themed_static 'js/custom-feather.js' %}"></script>
  <script src="{% themed_static 'js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% themed_static 'js/script.js' %}"></script>

  <!-- jQuery/auxiliares (se seu template original dependia) -->
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <script src="{% static 'js/wow.min.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>

  <!-- IMask para CPF/Telefone/Data -->
  <script src="https://unpkg.com/imask"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var elCpf = document.getElementById('cpf');
      var elPhone = document.getElementById('phone_number');
      var elDob = document.getElementById('date_of_birth');
      if (elCpf) IMask(elCpf, { mask: '000.000.000-00' });
      if (elPhone) IMask(elPhone, { mask: '(00) 00000-0000' });
      if (elDob) IMask(elDob, { mask: '00/00/0000' });
    });
  </script>
  <script>
  (function () {
    var href = "{% themed_static 'css/overrides.css' %}";
    var link = document.createElement('link');
    link.rel = 'stylesheet'; link.href = href;
    document.head.appendChild(link);
  })();
</script>
</body>
</html>
